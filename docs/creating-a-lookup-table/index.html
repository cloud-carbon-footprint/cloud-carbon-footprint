<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Cloud Carbon Footprint Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Cloud Carbon Footprint Blog Atom Feed"><title data-react-helmet="true">Creating a Lookup Table | Cloud Carbon Footprint</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Creating a Lookup Table | Cloud Carbon Footprint"><meta data-react-helmet="true" name="description" content="In order to support the big data processing requirements that some organizations have, it may be more practical or efficient for you to compute carbon metrics within your existing processing. To do so, we support the generation of a lookup table that can be utilized as an additional step in your pipeline."><meta data-react-helmet="true" property="og:description" content="In order to support the big data processing requirements that some organizations have, it may be more practical or efficient for you to compute carbon metrics within your existing processing. To do so, we support the generation of a lookup table that can be utilized as an additional step in your pipeline."><meta data-react-helmet="true" property="og:url" content="https://cloud-carbon-footprint.github.io/docs/creating-a-lookup-table"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://cloud-carbon-footprint.github.io/docs/creating-a-lookup-table"><link rel="stylesheet" href="/styles.fe12ef12.css">
<link rel="preload" href="/styles.619cf4c3.js" as="script">
<link rel="preload" href="/runtime~main.7dc05d1d.js" as="script">
<link rel="preload" href="/main.aebaf621.js" as="script">
<link rel="preload" href="/1.34396b93.js" as="script">
<link rel="preload" href="/2.8c18a0c1.js" as="script">
<link rel="preload" href="/01a85c17.a0a21750.js" as="script">
<link rel="preload" href="/1be78505.db4473ae.js" as="script">
<link rel="preload" href="/6875c492.5207ba8b.js" as="script">
<link rel="preload" href="/a6aa9e1f.8cccb324.js" as="script">
<link rel="preload" href="/c4f5d8e4.ac26fc5e.js" as="script">
<link rel="preload" href="/ccc49370.e3703ffc.js" as="script">
<link rel="preload" href="/51.84fdbbd3.js" as="script">
<link rel="preload" href="/50.1a4b6bd3.js" as="script">
<link rel="preload" href="/935f2afb.4df92823.js" as="script">
<link rel="preload" href="/17896441.85b4ac33.js" as="script">
<link rel="preload" href="/01e56ee4.c439e00d.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Cloud Carbon Footprint</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://demo.cloudcarbonfootprint.org/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__link">Demo</a><a class="navbar__item navbar__link navbar__link" href="/docs/getting-started">Get Started</a><a class="navbar__item navbar__link navbar__link" href="/docs/overview">Docs</a><a href="https://github.com/cloud-carbon-footprint/cloud-carbon-footprint" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__link">Github</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk" style="margin-left:1px">üåô</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk" style="margin-left:1px">‚òÄÔ∏è</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Cloud Carbon Footprint</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://demo.cloudcarbonfootprint.org/" target="_blank" rel="noopener noreferrer" class="menu__link navbar__link">Demo</a></li><li class="menu__list-item"><a class="menu__link navbar__link" href="/docs/getting-started">Get Started</a></li><li class="menu__list-item"><a class="menu__link navbar__link" href="/docs/overview">Docs</a></li><li class="menu__list-item"><a href="https://github.com/cloud-carbon-footprint/cloud-carbon-footprint" target="_blank" rel="noopener noreferrer" class="menu__link navbar__link">Github</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Cloud Carbon Footprint</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">How It Works</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/methodology">Methodology</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/classifying-usage-types">Classifying Usage Types</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/embodied-emissions">Embodied Emissions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/on-premise">On-Premise</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Running Locally</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/create-app">Create an App</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/run-with-mocked-data">Run with Mocked Data</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Connect to Real Data</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/aws">AWS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/gcp">GCP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/azure">Azure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/alternative-data-approaches">Alternative Data Approaches</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/get-recommendations">Get Recommendations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/run-with-docker">Run with Docker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/running-the-cli">Running the CLI</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/creating-a-lookup-table">Creating a Lookup Table</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Configuration Options</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data-persistence-and-caching">Data Persistence and Caching</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/performance-considerations">Performance Considerations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/configurations-glossary">Configurations Glossary</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deploying">Deploying</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Integrations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/backstage-plugins">Backstage Plugins</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Creating a Lookup Table</h1></header><div class="markdown"><p>In order to support the big data processing requirements that some organizations have, it may be more practical or efficient for you to compute carbon metrics within your existing processing. To do so, we support the generation of a lookup table that can be utilized as an additional step in your pipeline.</p><p>The lookup table maps the estimated energy (kilowatt-hours) and carbon emissions (CO2e) to 1 unit of usage, for all the unique combinations of region, service name, usage type and usage unit in the billing data of your cloud provider(s).</p><p>Once generated, this lookup table (CSV file) can be deployed to your ETL or other data processing pipeline. Then when processing your billing data, you can simply multiply your usage amount by the values in the lookup tables to estimate energy and CO2e. This approach avoids having to use the Cloud Carbon Footprint application code directly, and works regardless of the programming language or environment used in your pipeline.</p><p>To generate this lookup table:</p><ol><li>Make sure you have a CSV file inside the <code>cli</code> package, that contains all the unique region, service name, usage type and usage unit variations in your billing data, along with the vCPUs for that line item, if it exists. You can see an example of this using AWS data <a href="https://github.com/cloud-carbon-footprint/cloud-carbon-footprint/blob/trunk/packages/cli/src/__tests__/CreateLookupTable/aws_input.test.csv" target="_blank" rel="noopener noreferrer">here</a>, and <a href="#example-queries-to-create-input-csv-file">below</a> for example queries to create this file.</li><li>Run the following:</li></ol><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">yarn create-lookup-table &lt;options&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The options for this command are:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">--awsInput &lt;filename&gt; (required. name of input file, e.g. &quot;aws_input.csv&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--awsOutput &lt;filename&gt; (optional, defaults to &quot;aws_lookup_data.csv&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--gcpInput &lt;filename&gt; (required. name of input file, e.g. &quot;gcp_input.csv&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--gcpOutput &lt;filename&gt; (optional, defaults to &quot;gcp_lookup_data.csv&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--azureInput &lt;filename&gt; (required. name of input file, e.g. &quot;azure_input.csv&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--azureOutput &lt;filename&gt; (optional, defaults to &quot;azure_lookup_data.csv&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>We would like to thank <a href="https://github.com/mfulleratlassian" target="_blank" rel="noopener noreferrer">@mfulleratlassian</a> for contributing this functionality.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="example-queries-to-create-input-csv-file"></a>Example queries to create input CSV file<a class="hash-link" href="#example-queries-to-create-input-csv-file" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aws---athena-query"></a>AWS - Athena Query<a class="hash-link" href="#aws---athena-query" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SELECT </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">line_item_product_code as serviceName,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">product_region as region,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">line_item_usage_type as usageType,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pricing_unit as usageUnit,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">product_vcpu as vCpus</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">FROM &lt;your-cost-and-usage-reports-table&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">WHERE line_item_line_item_type IN (&#x27;Usage&#x27;, &#x27;DiscountedUsage&#x27;, &#x27;SavingsPlanCoveredUsage&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AND line_item_usage_start_date &gt;= DATE(&#x27;YYYY-MM-DD&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AND line_item_usage_start_date &lt;= DATE(&#x27;YYYY-MM-DD&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">GROUP BY 1, 2, 3, 4, 5</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="gcp---bigquery-query"></a>GCP - BigQuery Query<a class="hash-link" href="#gcp---bigquery-query" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SELECT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">service.description as serviceName,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ifnull(location.region, location.location) as region,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sku.description as usageType,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">usage.unit as usageUnit,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">system_labels.value AS machineType</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">FROM &lt;your-billing-export-table&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LEFT JOIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">UNNEST(system_labels) AS system_labels</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ON system_labels.key = &quot;compute.googleapis.com/machine_spec&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">WHERE cost_type != &#x27;rounding_error&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AND usage.unit IN (&#x27;byte-seconds&#x27;, &#x27;seconds&#x27;, &#x27;bytes&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AND usage_start_time &gt;= TIMESTAMP(&#x27;YYYY-MM-DD&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AND usage_end_time &lt;= TIMESTAMP(&#x27;YYYY-MM-DD&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">GROUP BY serviceName, region, usageType, usageUnit, machineType</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="azure---yarn-script"></a>Azure - Yarn Script<a class="hash-link" href="#azure---yarn-script" title="Direct link to heading">#</a></h3><p>Creating an input file for Azure using billing data requires the use of the Consumption Management API rather than a direct query.
To assist with this, we have created a script that makes use of your configured <a href="/docs/azure">credentials</a> in the <code>packages/cli/.env</code> file to query and output the needed mappings to a CSV file.</p><p>To use this script, run the following yarn command with the provided parameters:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">yarn create-azure-lookup &lt;options&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The options for this command are:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">--startDate &lt;YYYY-MM-DD&gt; (optional, defaults to 30 days prior to endDate)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--endDate &lt;YYYY-MM-DD&gt; (optional, defaults to current date)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--output &lt;filename&gt; (optional, defaults to &quot;azure_input.csv&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/running-the-cli"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Running the CLI</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/data-persistence-and-caching"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Data Persistence and Caching ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#example-queries-to-create-input-csv-file" class="table-of-contents__link">Example queries to create input CSV file</a><ul><li><a href="#aws---athena-query" class="table-of-contents__link">AWS - Athena Query</a></li><li><a href="#gcp---bigquery-query" class="table-of-contents__link">GCP - BigQuery Query</a></li><li><a href="#azure---yarn-script" class="table-of-contents__link">Azure - Yarn Script</a></li></ul></li></ul></div></div></div></div></main></div></div><div><section id="have-a-question"><div class="footerImageContainer_2H1A"><div><h2 class="footerImageTitle_1-0Q">Have a Question?</h2><a href="https://groups.google.com/g/cloud-carbon-footprint" target="_blank" rel="noopener noreferrer"><button class="MuiButtonBase-root MuiButton-root jss2 MuiButton-contained" tabindex="0" type="button"><span class="MuiButton-label">JOIN OUR DISCUSSION FORUM</span></button></a></div></div></section><div class="footerLicenseContainer_dmmY"><p>Cloud Carbon Footprint is an open-source project, sponsored by Thoughtworks Inc. under the¬†<a class="footerLicenseLink_jTO1" target="_blank" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a></p><p><a class="footerLicenseLink_jTO1" target="_blank" href="https://www.thoughtworks.com/privacy-policy">PRIVACY POLICY</a></p></div></div></div>
<script src="/styles.619cf4c3.js"></script>
<script src="/runtime~main.7dc05d1d.js"></script>
<script src="/main.aebaf621.js"></script>
<script src="/1.34396b93.js"></script>
<script src="/2.8c18a0c1.js"></script>
<script src="/01a85c17.a0a21750.js"></script>
<script src="/1be78505.db4473ae.js"></script>
<script src="/6875c492.5207ba8b.js"></script>
<script src="/a6aa9e1f.8cccb324.js"></script>
<script src="/c4f5d8e4.ac26fc5e.js"></script>
<script src="/ccc49370.e3703ffc.js"></script>
<script src="/51.84fdbbd3.js"></script>
<script src="/50.1a4b6bd3.js"></script>
<script src="/935f2afb.4df92823.js"></script>
<script src="/17896441.85b4ac33.js"></script>
<script src="/01e56ee4.c439e00d.js"></script>
</body>
</html>